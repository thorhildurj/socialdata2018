<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Assignment 2</title>
        <script type="text/javascript" src="./d3.js"></script>
        <style>
            body {
               width: 100%;
               display: flex;
               justify-content: center;
               flex-direction: row;
               line-height: 150%;
            }

            a {
              color: #0F6F9F;
              text-decoration: none;
            }

            a:hover {
              color: red;
            }

            .body-content {
              max-width: 800px;
            }

            .assignment-header {
              color: #0d8291;
              font-size: 450%;
            }

            .part-header {
              font-size: 250%;
              color: #0d8291;
            }

            .scroll-nav {
              cursor: pointer;
              color: blue;
              text-decoration: underline;
            }

            .thin-line {
              width: 100%;
              height: 1px;
              background-color: black;
            }

            .thick-line {
              width: 100%;
              height: 4px;
              background-color: black;
            }

            .small_text {
              font-size: 78%;
            }

            #part3-chart {
              /*border-style: solid;*/
            }

            .part3-chart-container {
              display: flex;
              flex-direction: row;
              align-items: center;
              margin: 10px;
              padding-left: 10px;
              border-style: double;
              border-width: 3px;
              border-color: black;
            }

            .part4-chart-container {
              display: flex;
              flex-direction: row;
              align-items: center;
            }

            .chart-option {
              cursor: pointer;
              color: black !important;
            }

            .option-fresh-fruit {
              color: #ff2419;
              list-style-type: square;
            }

            .option-fresh-vegetable {
              color: #018215;
              list-style-type: square;
            }

            .option-storage-fruit {
              color: #ff9397;
              list-style-type: square;
            }

            .option-both {
              color: purple;
              list-style-type: square;
            }

            .option-men {
              color: red;
              list-style-type: square;
            }

            .option-women {
              color: blue;
              list-style-type: square;
            }

            .option-storage-vegetable {
              color: #dae4c3;
              list-style-type: square;
            }

            .grid{ /* styling for the grid lines */
/*
                stroke: red;
                opacity: 0.7;
                */
                stroke: #25b898;
                color: green;
                background-color: green;
                stroke: red;
            }
            .grid path { /* styling for the grid lines */
              stroke-width: 0; /* to make the axis not thicker */
            }

            div.bar {
                display: inline-block;
                width: 20px;
                height: 75px; /* We'll override height later */
                background-color: teal;
                margin-right: 2px;
            }

            .part1-question_text li {
              color: gray;
              font-style: italic;
              margin-bottom: -18px;
              margin-top: 45px;
            }

        </style>
    </head>
    <body>
        <div class="body-content">
          <br />
          <br />
          <h1 class="assignment-header">Assignment 1</h1>

          <p>
            Here you can scroll to specific part of the assignment:
          </p>
          <ol>
            <li class="scroll-nav" id="scroll1">Part1: Telling Data Stories</li>
            <li class="scroll-nav" id="scroll2">Part2: Visualizing Murders over Time</li>
          </ol>

<!-- ########################  PART 1  ####################### -->
          <br />
          <br />
          <h2 class="part-header" id="part1">Part 1: Telling Data Stories</h2>

          <ul class="part1-question_text">
            <li>Question 1</li>
              <p>
                Answer 1<br/>
              </p>

            <li>Question 2</li>
              <p>
                Answer 2 <i style="font-size: 12px;">(Image 2.3. from Data Analysis with Open Source Tools by Philipp K. Janert).</i> </p>
            </ul>


<!-- ########################  PART 2  ####################### -->
          <br />
          <br />
          <h2 class="part-header" id="part2">Part 2: Visualizing Murders over Time</h2>
          <div id="part2-chart">

          </div>
          <div id="part2-map">

          </div>


          <br />
          <br />
          <br />
          <br />
          <br />
        </div>



        <script type="text/javascript">


          /**********************************
          ********** SCROLL LOGIC ***********
          ***********************************/

          document.getElementById("scroll1").onclick = function() {
            var elmnt = document.getElementById("part1");
            elmnt.scrollIntoView();
          };

          document.getElementById("scroll2").onclick = function() {
            var elmnt = document.getElementById("part2");
            elmnt.scrollIntoView();
          };


          /****************************
          ********** PART 2 ***********
          *****************************/


          /******* MAP *******/
          // variables for map
          var wMap = 600;
          var hMap = 600;

          //Create SVG element for map
          svg = d3.select("#part2-map")
                  .append("svg")
                  .attr("width", wMap)
                  .attr("height", hMap);

          //Define path for map
          var projection = d3.geoMercator()
                             .translate([wMap/0.013665, hMap/0.02255])
                             .scale([33800]);
          var path = d3.geoPath()
                       .projection(projection);


          /******* CHART *******/
          // variables for the bar chart
          var w = 1200;
          var h = 200;
          var xScale, yScale, svgChart, xAxis, yAxis;
          var padding = 40;
			    var parseTime = d3.timeParse("%m/%d/%Y"); //For converting strings to Dates
    			var rowConverter = function(d) {

    				return {
    					Date: parseTime(d.RPT_DT),
    					Latitude: d.Latitude,
    					Longitude: d.Longitude,
    				};
    			}


          //Load in GeoJSON data
          d3.json("boroughs.geojson", function(json) {

            /******* MAP *******/
            //Bind data and create one path per GeoJSON feature
            svg.selectAll("path")
               .data(json.features)
               .enter()
               .append("path")
               .attr("d", path)
               .style("fill", function(d){
                 var value = d.id

                 if (value == 0){
                   return "mediumaquamarine";
                 }
                 else if (value == 1){
                   return "MediumSeaGreen ";
                 }
                 else if (value == 2){
                   return "lightseagreen ";
                 }
                 else if (value == 3){
                   return "SeaGreen ";
                 }
                 else if (value == 4){
                   return "turquoise ";
                 }
               });

            //Create one label per state
            svg.selectAll("text")
             .data(json.features)
             .enter()
             .append("text")
             .attr("class", "label")
             .text(function(d) {
                  return d.properties.BoroName;
             })
             .attr("x", function(d) {
                return path.centroid(d)[0];
             })
             .attr("y", function(d) {
                return path.centroid(d)[1];
             })
             .attr('font-size', '12px')
             .attr('text-anchor', 'middle')
             .attr('font-family', 'Courier New')
             .attr('font-weight', 'bold');


             // we load the murder data and display the bar chart
             d3.csv("all_murder.csv", rowConverter, function(data) {

               /******* MAP *******/
               // displaying each murder as a circles on the map
               svg.selectAll("circle")
                  .data(data)
                  .enter()
                  .append("circle")
                  .attr("cx", function(d) {
                    return projection([d.Longitude, d.Latitude])[0];
                  })
                  .attr("cy", function(d) {
                     return projection([d.Longitude, d.Latitude])[1];
                  })
                  .attr("r", 1)
                  .style("fill", "indigo");

                /******* CHART *******/
                // grouping the murder data by date before rendering the bar chart
                var groupedData = d3.nest()
                  .key(function(d) { return d.Date; })
                  .entries(data);

                console.log("Grouped Data", groupedData)

                var dates = [];
                for (var i = 0; i < groupedData.length; i++) {
                  dates.push(groupedData[i].key);
                }

                var slicedNumber = 1000;
                groupedData = groupedData.slice(0, slicedNumber);
                dates = dates.slice(0, slicedNumber);

                // lets create the scales
                xScale = d3.scaleBand()
                  .domain(dates)
                  .rangeRound([padding, w]);  // 'rangeRound' enables rounding

                yScale = d3.scaleLinear()
                  .domain([0, d3.max(groupedData, function(d) { return d.values.length; })])
                  .range([h - padding, padding * 2]);


                yScale = d3.scaleLinear()
                  .domain([0, d3.max(groupedData, function(d) { return d.values.length; })])
                  .range([h - padding, padding * 2]);

                //Create SVG element
                svgChart = d3.select("#part2-chart")
                             .append("svg")
                             .attr("width", w)
                             .attr("height", h);

                //Create bars
                svgChart.selectAll("rect")
                        .data(groupedData)
                        .enter()
                        .append("rect")
                        .attr("x", function(d, i) {
                           return xScale(d.key);  // Setting x values
                        })
                        .attr("y", function(d) {
                           return yScale(d.values.length);
                        })
                        .attr("width", xScale.bandwidth())
                        .attr("height", function(d) {
                           return h - yScale(d.values.length) - padding;
                        })
                        .attr("fill", function(d) {
                           return "steelblue";
                        });

                  // Define X axis
                  xAxis = d3.axisBottom()
                      .scale(xScale)
                      .ticks(5);

                  //Define Y axis
                  yAxis = d3.axisLeft()
                            .scale(yScale)
                            .ticks(5);

                  //Create X axis
                  svgChart.append("g")
                          .attr("class", "x axis")
                          .attr("transform", "translate(0," + (h - padding) + ")")
                          .call(xAxis);

                  //Create Y axis
                  svgChart.append("g")
                          .attr("class", "y axis")
                          .attr("transform", "translate(" + padding + ",0)")
                          .call(yAxis);




             });

          });



        </script>
    </body>
</html>
