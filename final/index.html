<!DOCTYPE html>
<html lang="en">
    <head>
        <link href="https://fonts.googleapis.com/css?family=Nunito:200" rel="stylesheet">
        <meta charset="utf-8">
        <title>New York City taxi data</title>
        <script type="text/javascript" src="./d3.js"></script>
        <style>
            body {
               width: 100%;
               display: flex;
               flex-direction: column;
               line-height: 150%;
               font-family: 'Nunito', sans-serif;
               margin: 0;
               background-image: url(http://blog.getliquidlandscape.com/wp-content/uploads/2017/01/sos.png);
               background-position: left top;
               background-size: auto;
               background-repeat: repeat;
               background-attachment: fixed;
            }
            .top-bar-container {
              display: flex;
              flex-direction: column;
              background-color: #329b83;
              color: white;
              width: 100%;
            }

            .top-bar-inner-container {
              align-self: center;
              display: flex;
              flex-direction: row-reverse;
              width: 900px;
            }

            .top-bar-link {
              text-decoration: underline;
              color: white;
              padding: 20px 0 20px 100px;
              font-size: 24px;
              font-weight: 100;
            }

            .website-container {
              display: flex;
              flex-direction: column;
              width: 900px;
              align-self: center;
              background-color: white;
              padding: 50px 30px 50px 30px;
              margin: 55px 0 55px 0;
              box-shadow: 0 0 1px rgba(0, 0, 0, 0.15);
            }

            .button {
              color: white;
              background-color: #039be5;
              box-shadow: 0 2px 5px 0 rgba(0,0,0,.26);
              padding: 8px 16px;
              margin: 30px 0 0 0;
              text-decoration: none;
            }

        </style>
    </head>
    <body>

        <div class="top-bar-container">
          <div class="top-bar-inner-container">
            <a href="http://www.nyc.gov/html/tlc/html/about/trip_record_data.shtml" target="_blank" class="top-bar-link">The data</a>
            <a href="explainer" target="_blank" class="top-bar-link">Explainer page</a>
          </div>
        </div>

        <div class="website-container">
          <h1 class="assignment-header">NYC taxi data</h1>
          <p>
            We analyzed data for NYC taxi trips and we will show our findings here.

            <div class="website-container" id="geoMap">
              <h3>Here is geoMap</h3>
            </div>

            <div class="website-container" id="barChart">
              <h3>Here is a barchart</h3>
            </div>


            <br />
            <br />
            <br />
            <br />
            <a href="explainer" class="button" target="_blank">
              OPEN EXPLAINER ANALYSIS PAGE
            </a>

            <a href="http://www.nyc.gov/html/tlc/html/about/trip_record_data.shtml" class="button" target="_blank">
              DATA USED IN THE PROJECT
            </a>
          </p>

        </div>


        <script type="text/javascript">
        //Width and height
        var wMap = 600;
        var hMap = 600;

  			//Note: You need to lower the translate and make scale higher to make it a bigger map
        var projection = d3.geoMercator()
                           .translate([wMap/0.01087, hMap/0.01795])
                           .scale([42500]);

  			//Define path generator
  			var path = d3.geoPath()
  						       .projection(projection);

        //Define quantize scale to sort data values into buckets of color
        var colorMap = d3.scaleQuantize()
                      .range(["rgb(237,248,233)","rgb(186,228,179)","rgb(116,196,118)","rgb(49,163,84)","rgb(0,109,44)"]);


  			//Create SVG element
  			var svgMap = d3.select("#geoMap")
        						.append("svg")
        						.attr("width", wMap)
        						.attr("height", hMap);

        //Load in taxi zonedata
  			d3.csv("zones.csv", function(zoneData) {
          d3.csv("zones_passengers_all17.csv", function(zonePassengerData){

            //Set input domain for color scale, harð-kóðaði inn gildin á zones
            colorMap.domain([
              d3.min([0]),
              //d3.max(data, function(d) {return d.location_id; })
              d3.max([265])
            ]);

            //Load in GeoJSON data
      			d3.json("taxizones.json", function(json) {

              //Merge the taxi data and GeoJSON. Loop through once for each taxi data value
              for (var i = 0; i < zoneData.length; i++) {

                //Lets grap the name of the zone
                var dataZone = zoneData[i].zone;
                //Grab data value, that is the id of the zone, and convert from string to float
                var dataValue = parseFloat(zoneData[i].location_id);

                //Find the corresponding state inside the GeoJSON
                for (var j = 0; j < json.features.length; j++) {

                  var jsonZone = json.features[j].properties.zone;
                  if (dataZone == jsonZone) {
                    //Copy the data value into the JSON, þarf þetta því að við erum með location id í json-inu fyrir
                    json.features[j].properties.locationid = dataValue;
                    //Stop looking through the JSON
                    break;
                  }
                }
              }
              //"properties":{"objectid":3,"shape_leng":0.0843411059,"shape_area":0.00031441416,"zone":"Allerton/Pelham Gardens","locationid":3,"borough":"Bronx"}},
      				//Bind data and create one path per GeoJSON feature
      				svgMap.selectAll("path")
      				   .data(json.features)
      				   .enter()
      				   .append("path")
      				   .attr("d", path)
                 .style("fill", function(d) {
                    //Get data value
                    var value = d.properties.locationid;

                    if (value) {
                      //If value exists
                      return colorMap(value);
                    } else {
                      //If value is undefined
                      return "#ccc";
                    }
                 });
      			   });
             });
           });


//- - - - - - - - - - - - - - Creating a bar-chart - - - - - -- - - - - - - - - -
          d3.csv("passengerCount_all17.csv", function(taxiData) {
            wBar = 500;
            hBar = 500;
            xPaddingBar = 40;
            yPaddingBar = 75;

            // lets create the scales
            var xScaleBar = d3.scaleBand()
                          .domain(d3.range(taxiData.length))
                          .rangeRound([xPaddingBar, wBar])  // 'rangeRound' enables rounding
                          .paddingInner(0.1);

            var yScaleBar = d3.scaleLinear()
                          .domain([0, d3.max(taxiData, function(d) { return d.num; })])
                          .range([hBar - yPaddingBar, yPaddingBar * 2]); // double padding on the top to have room for title

            //Create SVG element
             var svgBar = d3.select("#barChart")
                    .append("svg")
                    .attr("width", wBar)
                    .attr("height", hBar);

            //Create bars
            svgBar.selectAll("rect")
               .data(taxiData)
               .enter()
               .append("rect")
               .attr("x", function(d) {
                  return xScaleBar(d.passenger_count);  // Setting x values
               })
               .attr("y", function(d) {
                  return yScaleBar(d.num);
               })
               .attr("width", xScaleBar.bandwidth())
               .attr("height", function(d) {
                  return hBar - yScaleBar(d.num) - yPaddingBar;
               })
               .attr("fill", "#25b898");

             // Define X axis
             var xAxisBar = d3.axisBottom()
                 .scale(xScaleBar);

             //Define Y axis
             var yAxisBar = d3.axisLeft()
                       .scale(yScaleBar)
                       .ticks(5);

             //Create X axis
             svgBar.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + (hBar - yPaddingBar) + ")")
                .call(xAxisBar);

             //Create Y axis
             svgBar.append("g")
               .attr("class", "y axis")
               .attr("transform", "translate(" + yPaddingBar + ",0)")
               .call(yAxisBar);


               // Setting y label
               svgBar.append("text")
                  .attr("transform", "rotate(-90)")
                  .attr("y", -3)
                  .attr("x",0 - (hBar/1.8))
                  .attr("dy", "1em")
                  .style("text-anchor", "middle")
                  .style("font-weight", "bolder")
                  .style("font-size", "11px")
                  .text("Amount of taxi rides");

              // Setting x label
              svgBar.append("text")
                 .attr("y", hBar - 45)
                 .attr("x", (wBar / 2))
                 .attr("dy", "1em")
                 .style("text-anchor", "middle")
                 .style("font-weight", "bolder")
                 .style("font-size", "11px")
                 .text("Amount of passengers in each ride");

          })





        </script>
    </body>
</html>
