<!DOCTYPE html>
<html lang="en">
    <head>
        <link href="https://fonts.googleapis.com/css?family=Nunito:200" rel="stylesheet">
        <meta charset="utf-8">
        <title>New York City taxi data</title>
        <script type="text/javascript" src="./d3.js"></script>
        <style>
            body {
               width: 100%;
               display: flex;
               flex-direction: column;
               line-height: 150%;
               font-family: 'Nunito', sans-serif;
               margin: 0;
               background-image: url(http://blog.getliquidlandscape.com/wp-content/uploads/2017/01/sos.png);
               background-position: left top;
               background-size: auto;
               background-repeat: repeat;
               background-attachment: fixed;
            }
            .top-bar-container {
              display: flex;
              flex-direction: column;
              background-color: #329b83;
              color: white;
              width: 100%;
            }

            .top-bar-inner-container {
              align-self: center;
              display: flex;
              flex-direction: row-reverse;
              width: 900px;
            }

            .top-bar-link {
              text-decoration: underline;
              color: white;
              padding: 20px 0 20px 100px;
              font-size: 24px;
              font-weight: 100;
            }

            .website-container {
              display: flex;
              flex-direction: column;
              width: 900px;
              align-self: center;
              background-color: white;
              padding: 50px 30px 50px 30px;
              margin: 55px 0 55px 0;
              box-shadow: 0 0 1px rgba(0, 0, 0, 0.15);
            }

            .website-container-inner {
              display: flex;
              flex-direction: column;
              width: 100%;
              align-self: center;
              background-color: white;
              padding: 50px 30px 30px 30px;
              margin: 55px 0 0 0;
              box-shadow: 0 -5px 1px -5px rgba(0, 0, 0, 0.15);
            }

            .button_bottom {
              color: white;
                align-self: center;
              width: 600px;
              background-color: #039be5;
              box-shadow: 0 2px 5px 0 rgba(0,0,0,.26);
              padding: 8px 16px;
              margin: 30px 0 0 0;
              text-decoration: none;
            }

            .play-hour-btn {
              width: 240px;
              align-self: center;
              color: white;
              background-color: #039be5;
              padding: 7px 20px 7px 20px;
            }

            #hours_chart1, #duration_chart1 {
              align-self: center;
            }

            .subtitle {
              font-size: 24px;
              font-weight: 200;
              color: #666;
              line-height: 160%;
              margin-top: 14px;
              margin-bottom: 10px;
            }

            .subtitle-less-spacing {
              margin-top: -4px;
              margin-bottom: 10px;
            }

            h1, h2 {
              font-weight: bolder;
            }

            .taxi_pic {
              width: 100%;
              height: auto;
              margin-top: 15px;
            }

            .pic_text {
              font-size: 10px;
              font-style: italic;
              color: #888;
              align-self: flex-end;
              margin-bottom: -20px;
            }

        </style>
    </head>
    <body>

        <div class="top-bar-container">
          <div class="top-bar-inner-container">
            <a href="http://www.nyc.gov/html/tlc/html/about/trip_record_data.shtml" target="_blank" class="top-bar-link">The data</a>
            <a href="explainer" target="_blank" class="top-bar-link">Explainer page</a>
          </div>
        </div>




        <div class="website-container">

          <h1 class="assignment-header">How to use data to gain leverage as a New York City taxi driver</h1>
          <p class="subtitle subtitle-less-spacing">
            New York City drivers can use data as an advantage and take data-driven decisions to maximize
            their income.
          </p>
          <p>
            Our findings on how New York City drivers can use data, to increase their chances on earning more money,
            will be shown below.
          </p>

          <img src="./taxis.jpg" class="taxi_pic"/>
          <span class="pic_text">
            Picture by
            <a href="https://www.publicdomainpictures.net/en/view-image.php?image=180391&picture=nyc-yellow-taxi" target="_blank">Public Domain Pictures.net</a>
          </span>

          <div class="website-container-inner">
            <h2>Some clever title here</h2>
            <p>
              We analyzed data for NYC taxi trips and we will show our findings here.

              <div id="geoMap">
                <h3>Here is geoMap</h3>

                <ul>
                  <li onclick="updateChartBar(1)"><span class="chart-option">Passenger amount: 1</span></li>
                  <li onclick="updateChartBar(2)"><span class="chart-option">Passenger amount: 2</span></li>
                  <li onclick="updateChartBar(3)"><span class="chart-option">Passenger amount: 3</span></li>
                  <li onclick="updateChartBar(4)"><span class="chart-option">Passenger amount: 4</span></li>
                  <li onclick="updateChartBar(5)"><span class="chart-option">Passenger amount: 5</span></li>
                  <li onclick="updateChartBar(6)"><span class="chart-option">Passenger amount: 6</span></li>
                </ul>

              </div>
            </div>

            <div class="website-container-inner">
              <h2>When during the day is the best time to drive?</h2>
              <p class="subtitle subtitle-less-spacing">
                How can taxi drivers use data to find out which hours they make the most money
              </p>
              <p>
                Lets start looking at how many trips are there for each hour of the day:
              </p>
              <div id="hours_chart2"></div>
              <p>
                From this graph, it is possible to see that there is more demand for New York
                taxis in the afternoon and in the evening but less demand during the morning and the nights.
                So for taxi drivers driving on high demands time, they decrease their probability to stay idle
                for a long time without passengers.
              </p>
              <p>
                But it is not enough to just look at when is the most demands for taxi drivers to maximize their
                income. It is also matters of how long each taxi trip is, the longer the trip is, the more it cost
                and the more money does the driver get.
              </p>
              <p class="subtitle">
                Looking at trip duration for different hours of the day
              </p>

              <p>
                By looking at how long the trips are in terms of time, or duration it is possible to examine
                how long the trips are on different hours of the day.
              </p>
              <p>
                Below there are two graphs to visualise that:
                <ul>
                  <li>An interactive, brushable, bar chart representing number of taxi trips of each hour</li>
                  <li>Bar chart representing number of taxi trips of different trip length (in minutes) in total of all the hours selected with the hour brush in the first bar chart</li>
                </ul>
                With the hour brush in the first bar chart, you can play around to see how
                the trip length of taxi trips changes for different hours, just highlight (brush)
                specific area in the first bar chart. To see the changes more easily you can use
                the "Animate brush" button, below the first bar chart, to see the changes visually
                automatically.
              </p>
              <div id="hours_chart1"></div>
              <button onclick="onHoursPlay()" class="play-hour-btn">Animate brush!</button>
              <br  />
              <div id="duration_chart1"></div>
              <p>
                When the trip duration is examined for different hours (try the "Animate brush" button)
                some useful information can be read from the visualisation. It seems that trips
                in the afternoon and in the evening are longer (longer duration) compared to trips
                during the night or before noon. This means that taxi drivers which want to get more
                money from each trip should rather work in the afternoon or in the evening as longer trips cost more.
              </p>
              <p>
                From this can be seen that there is both higher demands and longer trips in the afternoon and in the evening.
              </p>

            </div>

            <div class="website-container-inner">
              <h2>Conclusion</h2>
              <p>
                New York City taxi drivers can try to maximize their income by taking data-driven decisions.
                From the visualisation above, drivers can understand where and when they should drive to increase
                their chances of earning more money.
              </p>
            </div>


            <br />


            <a href="explainer" class="button_bottom" target="_blank">
              OPEN EXPLAINER ANALYSIS PAGE
            </a>

            <a href="http://www.nyc.gov/html/tlc/html/about/trip_record_data.shtml" class="button_bottom" target="_blank">
              DATA USED IN THE PROJECT
            </a>

            <br />
            <br />

            <img src="./taxis2.jpg" class="taxi_pic"/>
            <span class="pic_text">
              Picture by
              <a href="https://commons.wikimedia.org/wiki/File:Yellow_cabs_(4855499362).jpg" target="_blank">Wikimedia Commons</a>
            </span>

          </p>

        </div>


        <script type="text/javascript">


        /**************************************************/
        /************* COMMON VARIABLES STARTS *************/
        var width = 812;
        var height = 350;
        var padding = 40;

        function make_y_axis(scale, svg) {
          return d3.axisLeft()
                    .scale(scale)
                    .ticks(5);
        }
        /************** COMMON VARIABLES ENDS *************/
        /**************************************************/



        //Function to make a new subset dataset for passenger count on map
        var getSubDataset = function (datasetWithAllTypes, foodProduceIndex) {
          var dataset = [];
          for (var i = 0; i < datasetWithAllTypes.length; i++) {
            var entry = datasetWithAllTypes[i];
            passenger_value = parseFloat(entry.passenger_count)
            if (passenger_value === foodProduceIndex) {
              dataset.push(entry)
            }
          }
          return dataset;
        }

        //Width and height
        var wMap = 600;
        var hMap = 600;
        var datasetWithAllPassengers;
        var jsonData;
        var passengerIndex = 1;


  			//Note: You need to lower the translate and make scale higher to make it a bigger map
        var projection = d3.geoMercator()
                           .translate([wMap/0.01087, hMap/0.01795])
                           .scale([42500]);

  			//Define path generator
  			var path = d3.geoPath()
  						       .projection(projection);

        //Define quantize scale to sort data values into buckets of color
        var colorMap = d3.scaleQuantize()
                      .range(["rgb(237,248,233)","rgb(186,228,179)","rgb(116,196,118)","rgb(49,163,84)","rgb(0,109,44)"]);


  			//Create SVG element
  			var svgMap = d3.select("#geoMap")
        						.append("svg")
        						.attr("width", wMap)
        						.attr("height", hMap);

        //Load in taxi zonedata
        d3.csv("zones_passengers_all17.csv", function(data){

          //Load in GeoJSON data
          d3.json("taxizones.json", function(json) {

          datasetWithAllPassengers = data;
          jsonData = json;
          var subDataset = getSubDataset(datasetWithAllPassengers, passengerIndex, jsonData);

          //Set input domain for color scale
          colorMap.domain([
                  d3.min([0]),
                  d3.max(subDataset, function(d) {return d.num; })
                  ]);

            //Merge the taxi data and GeoJSON. Loop through once for each taxi data value
            for (var i = 0; i < subDataset.length; i++) {
              //Lets grap the id of the zone
              var zoneID = subDataset[i].PULocationID;
              //Grab the passenger value, and convert from string to float
              var passengerValue = parseFloat(subDataset[i].num);

              //Find the corresponding state inside the GeoJSON
              for (var j = 0; j < jsonData.features.length; j++) {
                var jsonZone = jsonData.features[j].properties.locationid;
                if (zoneID == jsonZone) {
                  //Copy the data value into the JSON
                  jsonData.features[j].properties.valueP = passengerValue;
                  //Stop looking through the JSON
                  break;
                }
              }
            }
            //Bind data and create one path per GeoJSON feature
    				svgMap.selectAll("path")
    				   .data(jsonData.features)
    				   .enter()
    				   .append("path")
    				   .attr("d", path)
               .style("fill", function(d) {
                  var value = d.properties.valueP;
                  if (value) {
                    return colorMap(value);
                  } else {
                    //If value is undefined
                    return "#ccc";
                  }
               });
    			   });
           });

           //Function to update the map when clicking the buttons
           var updateChartBar = function(passengerIndex) {

             //get the subdataset
             var subDataset = getSubDataset(datasetWithAllPassengers, passengerIndex, jsonData);
             //now update the map
             colorMap.domain([
                     d3.min([0]),
                     d3.max(subDataset, function(d) {return d.num; })
                     ]);

               //Merge the taxi data and GeoJSON. Loop through once for each taxi data value
               for (var i = 0; i < subDataset.length; i++) {
                 //Lets grap the id of the zone
                 var zoneID = subDataset[i].PULocationID;
                 //Grab the passenger value, and convert from string to float
                 var passengerValue = parseFloat(subDataset[i].num);

                 //Find the corresponding state inside the GeoJSON
                 for (var j = 0; j < jsonData.features.length; j++) {
                   var jsonZone = jsonData.features[j].properties.locationid;
                   if (zoneID == jsonZone) {
                     //Copy the data value into the JSON
                     jsonData.features[j].properties.valueP = passengerValue;
                     //Stop looking through the JSON
                     break;
                   }
                 }
               }
               //Bind data and create one path per GeoJSON feature
              svgMap.selectAll("path")
                 .data(jsonData.features)
                 .transition()
                 .duration(500)
                 .attr("d", path)
                 .style("fill", function(d) {
                     var value = d.properties.valueP;
                     if (value) {
                       return colorMap(value);
                     } else {
                       //If value is undefined
                       return "#ccc";
                     }
                  });

           }



          /***************************************************************
          *****               Barcharts with hours only              *****
          ****************************************************************/


          // Next we declare some usefule variables
          var possibleHoursOnly = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23];
          var positionsHoursOnly = [];
          var xScaleHoursOnlyChart, yScaleHoursOnlyChart, svgHoursOnlyChart, xAxisHoursOnlyChart, yAxisHoursOnlyChart;

          var rowHoursOnlyConverter = function(d) {
            return {
              hours: parseInt(d.hours),
              num: parseInt(d.num),
            };
          }


          d3.csv("data/hours_number_only.csv", rowHoursOnlyConverter, function(data) {

            var dataset = data;

            // lets create the scales
            xScaleHoursOnlyChart = d3.scaleBand()
              .domain(possibleHoursOnly)
              .rangeRound([padding * 2, width])  // 'rangeRound' enables rounding | double padding to make room for the numbers
              .paddingInner(0.5);

            // update positionsHoursOnly array
            for (var i = 0; i < 24; i++) {
              positionsHoursOnly.push(xScaleHoursOnlyChart(i));
            }

            yScaleHoursOnlyChart = d3.scaleLinear()
              .domain([0, d3.max(dataset, function(d) { return d.num; })])
              .range([height - padding, padding * 2]); // double padding on the top to have room for title

            //Create SVG element
            svgHoursOnlyChart = d3.select("#hours_chart2")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);

            // Setting chart lines (really long ticks)
            svgHoursOnlyChart.append("g")
               .call(make_y_axis(yScaleHoursOnlyChart, svgHoursOnlyChart)
                      .tickSize(-width, 0, 0)
                      .tickFormat("")
               )
               .attr("transform", "translate(" + padding * 2 + ",0)");

            //Create bars
            svgHoursOnlyChart.selectAll("rect")
               .data(dataset)
               .enter()
               .append("rect")
               .attr("x", function(d, i) {
                  return xScaleHoursOnlyChart(d.hours);  // Setting x values
               })
               .attr("y", function(d) {
                  return yScaleHoursOnlyChart(d.num);
               })
               .attr("class", function(d, i) {
                 return "hour-rect-no-" + i;
               })
               .attr("width", xScaleHoursOnlyChart.bandwidth())
               .attr("height", function(d) {
                  return height - yScaleHoursOnlyChart(d.num) - padding;
               })
               .attr("fill", function(d) {
                 return "#25b898"
               });

             // Define X axis
             xAxisHoursOnlyChart = d3.axisBottom()
                 .scale(xScaleHoursOnlyChart)
                 .tickValues(possibleHoursOnly);

             //Define Y axis
             yAxisHoursOnlyChart = d3.axisLeft()
                       .scale(yScaleHoursOnlyChart)
                       .ticks(5);

             //Create X axis
             svgHoursOnlyChart.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + (height - padding) + ")")
                .call(xAxisHoursOnlyChart);

             //Create Y axis
             svgHoursOnlyChart.append("g")
               .attr("class", "y axis")
               .attr("transform", "translate(" + padding * 2 + ",0)") // double padding to make room for the numbers
               .call(yAxisHoursOnlyChart);

             // Setting y label
             svgHoursOnlyChart.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0)
                .attr("x",0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .style("font-weight", "bolder")
                .style("font-size", "10px")
                .text("# of taxi trips");

            // Setting x label
            svgHoursOnlyChart.append("text")
               .attr("y", height - 15)
               .attr("x", (width / 2))
               .attr("dy", "1em")
               .style("text-anchor", "middle")
               .style("font-weight", "bolder")
               .style("font-size", "10px")
               .text("Hour");

             // Setting the title
             svgHoursOnlyChart.append("text")
                .attr("x", width / 2)
                .attr("y", padding) // we want little bit of padding from the top
                .attr("text-anchor", "middle")
                .style("font-size", "19px")
                .style("font-weight", "bolder")
                .text("Pickup Hour");

          });



          /***************************************************************
          *****                 Barcharts with hours                 *****
          ****************************************************************/

          // Next we declare some usefule variables
          var possibleHours = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23];
          var positionsHours = [];
          var xScaleHoursChart, yScaleHoursChart, svgHoursChart, xAxisHoursChart, yAxisHoursChart;
          var brushhour
          var hourDataset;

          var rowHoursConverter = function(d) {
            return {
              hours: parseInt(d.hours),
              num: parseInt(d.num),
            };
          }


          d3.csv("data/hours_number_only.csv", rowHoursConverter, function(data) {

            var dataset = data;
            hourDataset = dataset.slice();

            // lets create the scales
            xScaleHoursChart = d3.scaleBand()
              .domain(possibleHours)
              .rangeRound([padding * 2, width])  // 'rangeRound' enables rounding | double padding to make room for the numbers
              .paddingInner(0.5);

            // update positionsHours array
            for (var i = 0; i < 24; i++) {
              positionsHours.push(xScaleHoursChart(i));
            }

            yScaleHoursChart = d3.scaleLinear()
              .domain([0, d3.max(dataset, function(d) { return d.num; })])
              .range([height - padding, padding * 2]); // double padding on the top to have room for title

            //Create SVG element
            svgHoursChart = d3.select("#hours_chart1")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);

            // Setting chart lines (really long ticks)
            svgHoursChart.append("g")
               .call(make_y_axis(yScaleHoursChart, svgHoursChart)
                      .tickSize(-width, 0, 0)
                      .tickFormat("")
               )
               .attr("transform", "translate(" + padding * 2 + ",0)");

            //Create bars
            svgHoursChart.selectAll("rect")
               .data(dataset)
               .enter()
               .append("rect")
               .attr("x", function(d, i) {
                  return xScaleHoursChart(d.hours);  // Setting x values
               })
               .attr("y", function(d) {
                  return yScaleHoursChart(d.num);
               })
               .attr("class", function(d, i) {
                 return "hour-rect-no-" + i;
               })
               .attr("width", xScaleHoursChart.bandwidth())
               .attr("height", function(d) {
                  return height - yScaleHoursChart(d.num) - padding;
               })
               .attr("fill", function(d) {
                 return "#25b898"
               });

             // Define X axis
             xAxisHoursChart = d3.axisBottom()
                 .scale(xScaleHoursChart)
                 .tickValues(possibleHours);

             //Define Y axis
             yAxisHoursChart = d3.axisLeft()
                       .scale(yScaleHoursChart)
                       .ticks(5);

             //Create X axis
             svgHoursChart.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + (height - padding) + ")")
                .call(xAxisHoursChart);

             //Create Y axis
             svgHoursChart.append("g")
               .attr("class", "y axis")
               .attr("transform", "translate(" + padding * 2 + ",0)") // double padding to make room for the numbers
               .call(yAxisHoursChart);

             // Setting y label
             svgHoursChart.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0)
                .attr("x",0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .style("font-weight", "bolder")
                .style("font-size", "10px")
                .text("# of taxi trips");

            // Setting x label
            svgHoursChart.append("text")
               .attr("y", height - 15)
               .attr("x", (width / 2))
               .attr("dy", "1em")
               .style("text-anchor", "middle")
               .style("font-weight", "bolder")
               .style("font-size", "10px")
               .text("Hour");

             // Setting the title
             svgHoursChart.append("text")
                .attr("x", width / 2)
                .attr("y", padding) // we want little bit of padding from the top
                .attr("text-anchor", "middle")
                .style("font-size", "19px")
                .style("font-weight", "bolder")
                .text("Pickup Hour (brushable grap)");

            // setting the brush
            brushHour = d3.brushX()
                    .extent([[padding * 2, padding * 2], [width, height - padding]])
                    .on("brush", highlightBrushedHour)
                    .on("end", onBrushHourEnd);

            svgHoursChart.append("g")
                         .attr("class", "brush-hour")
                         .call(brushHour);


        });

        function onHoursPlay() {

          updateBrush(0);


        }

        function updateBrush(i)  {
          var numberOfRectChosenEachTime = 3;

          var leftPosition = xScaleHoursChart(i) + 3; // extra 3 because otherwise the brush will take one extra rect to the left
          var rightPosition = xScaleHoursChart(i + numberOfRectChosenEachTime) + 10; // 10 a random number so the edge of the brush is little bit more to the right
          d3.select(".brush-hour").call(brushHour.move, [leftPosition, rightPosition]);

          var newI = ++i;
          if (newI < 24 - numberOfRectChosenEachTime) {
            setTimeout(function() {
              updateBrush(++i)
            }, 400);
          }
        }

        function onBrushHourEnd () {
          if (!d3.event.selection) {
            // nothing is highlighted
            var leftHour = 0;
            var rightHour = 23;

            for (var i = 0; i < 24; i++) {
              svgHoursChart.selectAll(".hour-rect-no-" + i)
                 .data(hourDataset)
                 .transition()
                 .duration(300)
                 .attr("fill", function(d) {
                   return "#25b898";
                 });
            }

            // update map with selected data
            updateDurationMapWithSelectedData(leftHour, rightHour);
          }

        }


        function highlightBrushedHour() {
             if (d3.event.selection != null) {

               var extent = d3.event.selection;
               var leftHour = 0;
               var rightHour = 23;

               for (var i = 0; i < 24; i++) {
                 if (extent[0] > positionsHours[i]) {
                   leftHour = i;
                 }
               }

               for (var i = 23; i >= 0; i--) {
                 if (extent[1] < positionsHours[i]) {
                   rightHour = i - 1;
                 }
               }

               // if the width of the selection is zero (or so close to zero), than we use all hours
               if (Math.abs(extent[0] - extent[1]) < 3) { // less than 3 pixels
                 leftHour = 0;
                 rightHour = 23;
               }

               for (var i = 0; i < 24; i++) {
                 svgHoursChart.selectAll(".hour-rect-no-" + i)
                    .data(hourDataset)
                    .transition()
                    .duration(300)
                    .attr("fill", function(d) {

                      if (i < leftHour || i > rightHour) {

                        return "#999999";
                      }
                      return "#25b898";
                    });
               }

               // update map with selected data
               updateDurationMapWithSelectedData(leftHour, rightHour);
             }
         }




         /***************************************************************
         *****                Barcharts with duration               *****
         ****************************************************************/


//         function make_y_axis(scale, svg) {
//           return d3.axisLeft()
//                     .scale(scale)
//                     .ticks(5);
//         }

          // Next we declare some usefule variables
          var possibleDuration = Array.from(new Array(120), (x,i) => i);
          possibleDuration.splice(0, 1); // we don't have any trips with duration 0 minutes, so lets remove that as a possibility
          var xScaleDurationChart, yScaleDurationChart, svgDurationChart, xAxisDurationChart, yAxisDurationChart;
          var durationDataset;

          var rowDurationConverter = function(d) {
            return {
              minutes: parseInt(d.minutes),
              hours: parseInt(d.hours),
              num: parseInt(d.num),
            };
          }

          var sortOutDurationBasedOnHour = function(beginHour, endHour) {
            var newData = Array.from(new Array(120), (x,i) => i);
            for (var i = 0; i < newData.length; i++) {
              newData[i] = {'minutes': + i, 'num': 0  }
            }
            newData.splice(0, 1); // we don't have any trips with duration 0 minutes, so lets remove that as a possibility

            for (var i = 0; i < durationDataset.length ; i++) {
              if (durationDataset[i].hours >= beginHour && durationDataset[i].hours <= endHour) {
                var minutes = durationDataset[i].minutes;
                var numbers = durationDataset[i].num;
                newData[minutes - 1].num += numbers;
              }
            }

            return newData;
          }


          d3.csv("data/duration.csv", rowDurationConverter, function(data) {

            var dataset = data.slice();
            durationDataset = dataset.slice();
            dataset = sortOutDurationBasedOnHour(22,23);

            // lets create the scales
            xScaleDurationChart = d3.scaleBand()
              .domain(possibleDuration)
              .rangeRound([padding * 2, width])  // 'rangeRound' enables rounding | double padding to make room for the numbers
              .paddingInner(0.2);

            yScaleDurationChart = d3.scaleLinear()
              .domain([0, d3.max(dataset, function(d) { return d.num; })])
              .range([height - padding, padding * 2]); // double padding on the top to have room for title

            //Create SVG element
            svgDurationChart = d3.select("#duration_chart1")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);

//            // Setting chart lines (really long ticks)
//            svgDurationChart.append("g")
//               .call(make_y_axis(yScaleDurationChart, svgDurationChart)
//                      .tickSize(-width, 0, 0)
//                      .tickFormat("")
//               )
//               .attr("transform", "translate(" + padding * 2 + ",0)");

            //Create bars
            svgDurationChart.selectAll("rect")
               .data(dataset)
               .enter()
               .append("rect")
               .attr("x", function(d, i) {
                  return xScaleDurationChart(d.minutes);  // Setting x values
               })
               .attr("y", function(d) {
                  return yScaleDurationChart(d.num);
               })
               .attr("width", xScaleDurationChart.bandwidth())
               .attr("height", function(d) {
                  return height - yScaleDurationChart(d.num) - padding;
               })
               .attr("fill", function(d) {
                 return "#25b898"
               });

             // to skip some ticks on x axis we create new array
             var xAxisTicks = possibleDuration.slice();;
             for (var i = 0; i < xAxisTicks.length; i++) {
               if ((i + 1) % 5 == 0) {

               } else if (i != 0) {
                 xAxisTicks[i] = 1; // so we just draw a lot of ticks for "1" on the x axis
               }

             }

             // Define X axis
             xAxisDurationChart = d3.axisBottom()
                 .scale(xScaleDurationChart)
                 .tickValues(xAxisTicks);
                 //.tickValues(xAxisTicks);

             //Define Y axis
             yAxisDurationChart = d3.axisLeft()
                       .scale(yScaleDurationChart)
                       .ticks(5);

             //Create X axis
             svgDurationChart.append("g")
                .attr("class", "x_duration axis_duration")
                .attr("transform", "translate(0," + (height - padding) + ")")
                .call(xAxisDurationChart);

             //Create Y axis
             svgDurationChart.append("g")
               .attr("class", "y_dyration axis_duration")
               .attr("transform", "translate(" + padding * 2 + ",0)") // double padding to make room for the numbers
               .call(yAxisDurationChart);

             // Setting y label
             svgDurationChart.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0)
                .attr("x",0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .style("font-weight", "bolder")
                .style("font-size", "10px")
                .text("# of taxi trips");

            // Setting x label
            svgDurationChart.append("text")
               .attr("y", height - 15)
               .attr("x", (width / 2))
               .attr("dy", "1em")
               .style("text-anchor", "middle")
               .style("font-weight", "bolder")
               .style("font-size", "10px")
               .text("Minutes");

             // Setting the title
             svgDurationChart.append("text")
                .attr("x", width / 2)
                .attr("y", padding) // we want little bit of padding from the top
                .attr("text-anchor", "middle")
                .style("font-size", "19px")
                .style("font-weight", "bolder")
                .text("Trip duration");

          });


          var updateDurationMapWithSelectedData = function(leftHour, rightHour) {
            var dataset = sortOutDurationBasedOnHour(leftHour, rightHour);

            yScaleDurationChart.domain([0, d3.max(dataset, function(d) { return d.num; })]);


            // updating all bars
            svgDurationChart.selectAll("rect")
               .data(dataset)
               .transition()
               .duration(1000)
               .attr("x", function(d, i) {
                  return xScaleDurationChart(d.minutes);  // Setting x values
               })
               .attr("y", function(d) {
                  return yScaleDurationChart(d.num);
               })
               .attr("width", xScaleDurationChart.bandwidth())
               .attr("height", function(d) {
                  return height - yScaleDurationChart(d.num) - padding;
               })
               .attr("fill", function(d) {
                 return "#25b898"
               });


               //Update Y axis
               svgDurationChart.select(".y_dyration.axis_duration")
                   .transition()
                   .duration(1000)
                   .call(yAxisDurationChart);

          }








        </script>
    </body>
</html>
